<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Claudium</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/cdf8a73b8c.js" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="css/style.css">

    <link href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    
     <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>


  <!--Inicio Nav-->
  <nav class="navbar navbar-dark stick-top p-3">

    <div class="container-fluid">

      <!--barra-->
      <button src class="navbar-toggler" style="background-color: #33a3ff54" type="button" data-bs-toggle="offcanvas"
        data-bs-target="#offcanvasDarkNavbar" aria-controls="offcanvasDarkNavbar" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!--imagem-->
      <a class="navbar-brand text-primary" id="btn-perfil" type="button" style="align-content: center;"
        href="login_signup.html">
        <i class="fa-solid fa-user"></i> Entrar
      </a>

      <div class="offcanvas offcanvas-start text-bg-dark bg-primary" tabindex="-1" id="offcanvasDarkNavbar"
        aria-labelledby="offcanvasDarkNavbarLabel">
        <div class="offcanvas-header">
          <h3 class="offcanvas-title p-2" id="offcanvasDarkNavbarLabel">Claudium</h3>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"
            aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">

          <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="index.html"> <i class="fa-solid fa-house"></i> Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="local.html"><i class="fa-solid fa-location-dot"></i>
                Localização</a>
            </li>

            <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="favoritos.html"> <i class="fa-solid fa-heart"></i>
                  Favoritos</a>
              </li>

              <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="radar.html"> <i
                      class="fa-solid fa-earth-americas"></i>
                    Radar Meteriológico</a>
                </li>

                <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                  <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="alertas.html"> <i class="fa-solid fa-bell"></i>
                      Alertas</a>
                  </li>



        </div>

        <div class="p-4">
          <hr id="hr_nav">

          <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="perfil.html#configuracoes"> <i
                  class="fa-solid fa-gear"></i>
                Preferências</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="admin.html"> <i class="fa-solid fa-wrench"></i>
                Página do admin</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="suporte.html"><i class="fa-solid fa-comments"></i>
                Fale conosco</a>
            </li>
          </ul>
        </div>

        <br><br>

        <p class="container-fluid p-4" id="nav_copy">&copy;2024 Cloudium | All Rights Reserved</p>
      </div>
    </div>

  </nav>

  <!--fim nav-->

  <br><br><br>
  
    <center><h1 class="h1_semana">Radar de alertas</h1></center>
    <br>
        <div class="row">
              <div id="map"></div>
        </div>
        <div class="row">
          <div class="col-3">
            <center><img src="img/mascote.png" class="mascote"></center>
          </div><div class="col-8">
            <br><br>
            <div class="legend">
              <div class="legend-title">Legenda do Mapa</div>
              <div class="legend-grid">
                <div class="legend-item">
                <div class="color-box yellow"></div>
                <span>Alerta Amarelo - Perigo Potencial</span>
              </div>
              <div class="legend-item">
                <div class="color-box orange"></div>
                <span>Alerta Laranja - Perigo</span>
              </div>
              <div class="legend-item">
                <div class="color-box red"></div>
                <span>Alerta Vermelho - Grande Perigo</span>
              </div>
                <div class="legend-item">
                  <img src="img/ChuvaIntensa.png" width="40px" alt="Chuva intensa">
                  <span>Chuva intensa</span>
                </div>
                <div class="legend-item">
                  <img src="img/DeclinioDaTemperatura.png" width="40px" alt="Declínio da temperatura">
                  <span>Declínio da temperatura</span>
                </div>
                <div class="legend-item">
                  <img src="img/Estiagem.png" width="40px" alt="Estiagem">
                  <span>Estiagem</span>
                </div>
                <div class="legend-item">
                  <img src="img/Friagem.png" width="40px" alt="Friagem">
                  <span>Friagem</span>
                </div>
                <div class="legend-item">
                  <img src="img/Geada.png" width="40px" alt="Geada">
                  <span>Geada</span>
                </div>
                <div class="legend-item">
                  <img src="img/Granizo.png" width="40px" alt="Granizo">
                  <span>Granizo</span>
                </div>
                <div class="legend-item">
                  <img src="img/Incendios.png" width="40px" alt="Incêndios">
                  <span>Incêndios</span>
                </div>
                <div class="legend-item">
                  <img src="img/OndaDeCalor.png" width="40px" alt="Onda de calor">
                  <span>Onda de calor</span>
                </div>
                <div class="legend-item">
                  <img src="img/OndaDeFrio.png" width="40px" alt="Onda de frio">
                  <span>Onda de frio</span>
                </div>
              </div>
            </div>
          </div>
          
        </div>

    </div>
   



 
  <!--Footer Universal-->

  <footer class="footer_uni">
    <div class="row col">
      <div class="waves">
        <div class="wave" id="wave1"></div>
        <div class="wave" id="wave2"></div>
        <div class="wave" id="wave3"></div>
        <div class="wave" id="wave4"></div>
      </div>
      <ul class="menu">
        <li class="menu__item"><a class="menu__link" href="index.html"><i class="fa-solid fa-house"></i> Home</a></li>
        <li class="menu__item"><a class="menu__link" href="suporte.html"><i class="fa-solid fa-comments"></i> Fale conosco</a></li>

      </ul>
    </div>
    <p>&copy;2024 Cloudium | All Rights Reserved</p>

  </footer>

  <!-- Botão Voltar ao Topo -->
  <button onclick="topFunction()" id="backToTopBtn" title="Voltar ao topo">
    <i class="fa-solid fa-arrow-up"></i>
  </button>
      <script>
        // Obtém o botão
        var mybutton = document.getElementById("backToTopBtn");

        // Quando o usuário rolar para baixo 20px do topo da página, mostra o botão
        window.onscroll = function () {
          if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            mybutton.style.display = "block";
          } else {
            mybutton.style.display = "none";
          }
        };

        // Quando o usuário clicar no botão, rola para o topo da página
        function topFunction() {
          document.body.scrollTop = 0; // Para Safari
          document.documentElement.scrollTop = 0; // Para Chrome, Firefox, IE e Opera
        }
      </script>


  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>


  <script src="js/sript_weather.js"></script>
</body>



<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
crossorigin=""/>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

     <script src="js/index.js"></script>
    <script>
                var map = L.map("map").setView([-23.695767137208858, -46.547940912796], 8);
        L.tileLayer(
        "https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}.png",
        {
            attribution:
            '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
        }
        ).addTo(map);

        // Defina os limites do mapa
        var southWest = L.latLng(-33.75, -73.99),
        northEast = L.latLng(5.27, -32.45);
        var bounds = L.latLngBounds(southWest, northEast);
        map.setMaxBounds(bounds);
        map.fitBounds(bounds);

        // Conjunto para armazenar identificadores únicos de alertas
        const alertasExibidos = new Set();

        // Faz a consulta de alertas no INMET
        fetch(`https://apiprevmet3.inmet.gov.br/avisos/rss?timestamp=${new Date().getTime()}`)
        .then((response) => response.text())
        .then((str) => new window.DOMParser().parseFromString(str, "text/xml"))
        .then((data) => {
            const items = data.querySelectorAll("item");

            items.forEach((item) => {
            const link = item.querySelector("link").textContent;

            fetch(link)
                .then((response) => response.text())
                .then((str) => new window.DOMParser().parseFromString(str, "text/xml"))
                .then((innerData) => {
                const Titulo = innerData.querySelector("headline").textContent;
                const Inicio = innerData.querySelector("onset").textContent;
                const Fim = innerData.querySelector("expires").textContent;

                // Cria um identificador único para o alerta
                const idAlerta = `${Titulo}-${Inicio}-${Fim}`;

                if (!alertasExibidos.has(idAlerta) && seAlertaAtivo(Inicio, Fim)) {
                    const Descricao = innerData.querySelector("description").textContent;
                    const Instrucao = innerData.querySelector("instruction").textContent;
                    const Polygon = innerData.querySelector("polygon").textContent;
                    const Parametros = innerData.querySelectorAll('parameter');
                    const Cor = PegarCor(Parametros);
                    const Evento = innerData.querySelector("event").textContent;

                    // Adiciona o identificador ao conjunto
                    alertasExibidos.add(idAlerta);

                    if (Polygon) {
                    const coordenadas = Polygon.trim()
                        .split(" ")
                        .map((coord) => {
                        const [lat, lon] = coord.split(",");
                        return [parseFloat(lat), parseFloat(lon)];
                        });

                    // Adiciona o polígono ao mapa com fillOpacity definido
                    const poligono = L.polygon(coordenadas, { color: Cor, fillOpacity: 0.40 }).addTo(map);

                    // Centraliza o marcador no polígono
                    const centro = poligono.getBounds().getCenter();
                    const marcador = L.marker(centro, { icon: AdicionarIcone(Evento) }).addTo(map);

                    // Adiciona o pop-up com título e descrição do alerta
                    marcador.bindPopup(`<b>${Titulo}</b><br>${Descricao}<br><br><b>Instrução:</b> ${Instrucao}`).openPopup();
                    }
                }
                })
                .catch((erro) => console.error("Erro ao processar o alerta: " + erro));
            });
        })
        .catch((erro) => console.error("Erro ao parsear o feed RSS: " + erro));

        function seAlertaAtivo(Inicio, Fim) {
        const now = new Date();

        const DataDeInicio = new Date(Inicio);
        const DataDoFim = new Date(Fim);

        // Verifica se a data/hora atual está entre o início e o fim
        return now >= DataDeInicio && now <= DataDoFim;
        }

        function PegarCor(Parametros) {
        for (let Parametro of Parametros) {
            const valueName = Parametro.querySelector('valueName');
            if (valueName && valueName.textContent === 'ColorRisk') {
            const valueElement = Parametro.querySelector('value');
            if (valueElement) {
                return valueElement.textContent;
            }
            }
        }
        return null; // Retorna null se não encontrar o parâmetro ColorRisk
        }

        function AdicionarIcone(Evento) {
        let iconeUrl;
        switch (Evento)
        {
            case 'Ventos Costeiros':
                iconeUrl = 'IMG/VentoCosteiro.png';
            break;
            case 'Ressaca':
                iconeUrl = 'IMG/Ressaca.png'
                break;
            case 'Onda de Frio':
                iconeUrl = 'IMG/OndaDeFrio.png';
                break;
            case 'Tornados':
                iconeUrl = 'IMG/Tornado.png';   
                break;
            case 'Tempestade de Raios':
                iconeUrl = 'IMG/TempestadeDeRaio.png';
                break;
            case 'Granizo':
                    iconeUrl = 'IMG/Granizo.png';
                break;
            case 'Chuvas Intensas':
                    iconeUrl = 'IMG/ChuvaIntensa.png';
                break;
            case 'Vendaval':
                iconeUrl = 'IMG/Vendavel.png';
                break;
            case 'Onda de Calor':
                iconeUrl = 'IMG/OndaDeCalor.png';
                break;
            case 'Friagem':
                iconeUrl = 'IMG/Friagem.png';
                break;
            case 'Geada':
                iconeUrl = 'IMG/Geada.png';
                break;
            case 'Estiagem':
                iconeUrl = 'IMG/Estiagem.png';
                break;
            case 'Seca':
                iconeUrl = 'IMG/Estiagem.png';
                break;
            case 'Incêndios':
                iconeUrl = 'IMG/Incendios.png';
                break;
            case 'Baixa Umidade':
                iconeUrl = 'IMG/Estiagem.png';
                break;
            case 'Neve':
                iconeUrl = 'IMG/Geada.png';
                break;
            case 'Declínio de Temperatura':
                iconeUrl = 'IMG/DeclinioDaTemperatura';
                break;
            case 'Acumulado de Chuva':
                iconeUrl = 'IMG/ChuvaIntensa.png';
                break;
            case 'Tempestade':
                iconeUrl='IMG/Tempestade.png'
                break;
        }

        return L.icon({
            iconUrl: iconeUrl, // Caminho para a imagem do ícone
            iconSize: [38, 38], // Tamanho do ícone
            iconAnchor: [19, 38], // Ponto de ancoragem do ícone (base)
            popupAnchor: [-3, -76] // Ponto de ancoragem do pop-up relativo ao ícone
        });
        }

    </script>
     </html>